!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){(function(e){const t=s(2);var i="undefined"==typeof window?"undefined"==typeof self?e:self:window;i.mips={assemble:e=>{try{return i.mips._a=new t.Assembler(e),i.mips._a.assemble(),i.mips._a.instructionsDisplay}catch(e){throw i.mips._a=null,e}},step:()=>{if(!i.mips._a)throw Error("A program needs to be assembled first");return i.mips._a.machine.step()},backstep:()=>{if(!i.mips._a)throw Error("A program needs to be assembled first");return i.mips._a.machine.undoStep()},changesOfLastInstruction:()=>{if(!i.mips._a)throw Error("A program needs to be assembled first");return i.mips._a.machine.changesOfLastInstruction()}}}).call(this,s(1))},function(e,t){var s;s=function(){return this}();try{s=s||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){const i=s(3),r=i.Address,a=i.Instruction,h=i.LabeledData,n=i.IntData,c=i.BytesData,o=i.AlignedData,l=i.LabeledInstruction,u=s(4);class p{constructor(e,t,s,i){this.type=e,this.text=t,this.line=s,this.column=i}}let m=/^[-]{0,1}\d+$/g,d=/^0x[a-fA-F0-9]+$/g;class g extends Error{constructor(e,t,s){super(e),this.line=t,this.column=s}}let k=new Set([".data",".text",".word",".half",".byte",".ascii",".asciiz",".globl"]);class w{constructor(e){this.src=e,this.index=0,this.line=0,this.column=0,this.peek=null}static isWhitespace(e){return" "==e||"\r"==e||"\t"==e}static isSpecial(e){return":"==e||","==e||"("==e||")"==e}substring(e){return this.src.substring(e,this.index)}eatWhitespace(){let e=this.src.charAt(this.index);for(;w.isWhitespace(e)&&(this.advanceChar(),!(this.index>=this.src.length));)e=this.src.charAt(this.index)}advanceChar(){"\n"==this.src.charAt(this.index)?(this.line++,this.column=0):this.column++,this.index++}peekToken(){return this.peek||(this.peek=this.nextTokenInternal()),this.peek}nextToken(){if(this.peek){let e=this.peek;return this.peek=null,e}return this.nextTokenInternal()}nextTokenInternal(){if(this.eatWhitespace(),this.index>=this.src.length)return new p("EOF","",this.line,this.column);let e=!1,t=!1,s=this.index,i="",r=this.line,a=this.column;for(;this.index<this.src.length;){let h=this.src.charAt(this.index);if(e){if('"'==h)return e=!1,this.advanceChar(),new p("STRING",i,r,a);if("\\"==h){if(this.advanceChar(),this.index>=this.src.length)throw new g("file ends after backslash in string",this.line,this.column);if("n"==(h=this.src.charAt(this.index)))i+="\n";else if("\\"==h)i+="\\";else if('"'==h)i+='"';else if("t"==h)i+="\t";else{if("r"!=h)throw new g("ERROR","unknown char '"+h+"' after backslash in string",this.line,this.column);i+="\r"}}else{if("\n"==h)throw new g("ERROR","newline in string",this.line,this.column);i+=h}}else if(t){if("\n"==h)return this.advanceChar(),new p("NEWLINE","\n",r,a)}else{if("\n"==h){if(this.index-s>0)break;return this.advanceChar(),new p("NEWLINE","\n",r,a)}if('"'==h){if(this.index-s>0)break;e=!0}else if("#"==h){if(this.index-s>0)break;t=!0}else if(w.isSpecial(h)){if(this.index-s>0){if("."==h){this.advanceChar();continue}break}if(this.advanceChar(),"."==h)return new p("DOT",".",r,a);if(":"==h)return new p("COLON",":",r,a);if(","==h)return new p("COMMA",",",r,a);if("("==h)return new p("LPAREN","(",r,a);if(")"==h)return new p("RPAREN",")",r,a)}else if(w.isWhitespace(h))break}this.advanceChar()}if(t)return new p("EOF","",this.line,this.column);if(e)throw new g("ERROR","unterminated string",this.line,this.column);let h=this.substring(s);return k.has(h)?new p("ANNOTATION",h,r,a):m.test(h)||d.test(h)?new p("NUMBER",h,r,a):new p("IDENTIFIER",h,r,a)}}class b extends Error{constructor(e,t){super(e),this.line=t.line,this.column=t.column}}let f={$zero:0,$at:1,$v0:2,$v1:3,$a0:4,$a1:5,$a2:6,$a3:7,$t0:8,$t1:9,$t2:10,$t3:11,$t4:12,$t5:13,$t6:14,$t7:15,$s0:16,$s1:17,$s2:18,$s3:19,$s4:20,$s5:21,$s6:22,$s7:23,$t8:24,$t9:25,$k0:26,$k1:27,$gp:28,$sp:29,$fp:30,$ra:31};for(let e=0;e<31;e++)f["$"+e]=e;let x={memoryInstructions:{lb:!0,lbu:!0,lh:!0,lhu:!0,lw:!0,sb:!0,sh:!0,sw:!0,la:!0},threeRegister:{add:!0,addu:!0,and:!0,nor:!0,or:!0,sub:!0,subu:!0,xor:!0,slt:!0,sltu:!0,sllv:!0,srav:!0,srlv:!0},twoRegisterImmediate:{addi:!0,addiu:!0,andi:!0,ori:!0,xori:!0,slti:!0,sltiu:!0,sll:!0,sra:!0,srl:!0},noParameters:{syscall:!0,nop:!0},registerLabel:{bgez:!0,bgezal:!0,bgtz:!0,blez:!0,bltz:!0,bltzal:!0},divMult:{div:!0,divu:!0,mul:!0,mult:!0,multu:!0},hiLo:{mfhi:!0,mflo:!0,mthi:!0,mtlo:!0}};class R{constructor(e){this.lexer=new w(e)}peek(e){return this.lexer.peekToken().type==e}expect(e,t){let s=this.lexer.nextToken();if(e!=s.type&&s.type!=t)throw new b(t?"Expected token of type '"+e+"' or '"+t+"' but got '"+s.type+"'":"Expected token of type '"+e+"' but got '"+s.type+"'",s);return s.text}peekAndDiscard(e){this.peek(e)&&this.discard()}discard(){this.lexer.nextToken()}parseRegister(){let e=this.lexer.nextToken();if("IDENTIFIER"!=e.type)throw new b("Expected register, got token of type "+e.type,e);if(void 0!==f[e.text])return f[e.text];throw new b("Expected register, got '"+e.text+"'",e)}parseAddress(){let e=this.lexer.nextToken(),t=null,s=null;if("LPAREN"==e.type){let e=this.parseRegister();return this.expect("RPAREN"),new r(e,null,null)}if("NUMBER"==e.type)t=parseInt(e.text);else{if("IDENTIFIER"!=e.type)throw new b("Expected address, got token of type "+token.type,token);s=e.text}let i=null;return this.peek("LPAREN")&&(this.discard(),i=this.parseRegister(),this.expect("RPAREN")),new r(i,s,t)}parseMemoryInstruction(e){let t=this.parseRegister();return this.peekAndDiscard("COMMA"),new a(e,[t,this.parseAddress()])}parseThreeRegisterInstruction(e){let t=this.parseRegister();this.peekAndDiscard("COMMA");let s=this.parseRegister();return this.peekAndDiscard("COMMA"),new a(e,[t,s,this.parseRegister()])}parseTwoRegisterImmediateInstruction(e){let t=this.parseRegister();this.peekAndDiscard("COMMA");let s=this.parseRegister();return this.peekAndDiscard("COMMA"),new a(e,[t,s,parseInt(this.expect("NUMBER"))])}parseRegisterLabelInstruction(e){let t=this.parseRegister();this.peekAndDiscard("COMMA");let s=this.expect("IDENTIFIER");return new a(e,[t,s])}parse(){let e=[],t=[],s=!0,i=this.lexer.nextToken(),r=[],u=null;for(;"EOF"!=i.type;){if("ANNOTATION"==i.type){let t=i.text,a=null;switch(t){case".align":u=parseInt(this.expect("NUMBER"));break;case".word":if(s)throw new b("word directive is not allowed in text segment",i);a=new n(parseInt(this.expect("NUMBER")),4);break;case".half":if(s)throw new b("half directive is not allowed in text segment",i);a=new n(parseInt(this.expect("NUMBER")),2);break;case".byte":if(s)throw new b("byte directive is not allowed in text segment",i);a=new n(parseInt(this.expect("NUMBER")),1);break;case".text":r=[],s=!0;break;case".data":r=[],s=!1;break;case".asciiz":case".ascii":if(s)throw new b("asciiz directive is not allowed in text segment",i);let e=this.expect("STRING"),h=new Uint8Array(e.length+(".asciiz"==t?1:0));for(let t=0;t<e.length;t++){let s=e.charCodeAt(t);if(s<0||s>127)throw new b("invalid character with char code "+s+" in ascii(z) string",i);h[t]=s}a=new c(h);break;case".globl":this.expect("IDENTIFIER")}null!=a&&(null!=u&&(a=new o(u,a),u=null),0!=r.length&&(a=new h(r,a),r=[]),e.push(a))}else if("IDENTIFIER"==i.type)if(this.peek("COLON"))this.discard(),r.push(i.text);else{let e=i.text.toLowerCase(),s=null;if(x.memoryInstructions[e])s=this.parseMemoryInstruction(i);else if(x.threeRegister[e])s=this.parseThreeRegisterInstruction(i);else if(x.twoRegisterImmediate[e])s=this.parseTwoRegisterImmediateInstruction(i);else if(x.noParameters[e])s=new a(i,[]);else if(x.registerLabel[e])s=this.parseRegisterLabelInstruction(i);else if(x.hiLo[e])s=new a(i,[this.parseRegister()]);else if("j"==e||"jal"==e){let e=this.expect("IDENTIFIER");s=new a(i,[e])}else if("lui"==e||"li"==e){let e=this.parseRegister();this.expect("COMMA");let t=this.expect("NUMBER");s=new a(i,[e,parseInt(t)])}else if(x.divMult[e]){let e=this.parseRegister();this.expect("COMMA");let t=this.parseRegister();s=new a(i,[e,t])}else if("jalr"==e){let e=this.parseRegister(),t=null;this.peek("COMMA")&&(this.discard(),t=this.parseRegister()),s=new a(i,null!==t?[e,t]:[31,e])}else if("jr"==e)s=new a(i,[this.parseRegister()]);else{if("beq"!=e&&"bne"!=e)throw new b("Unknown instruction '"+i.text+"'",i);{let e=this.parseRegister();this.peekAndDiscard("COMMA");let t=this.parseRegister();this.peekAndDiscard("COMMA");let r=this.expect("IDENTIFIER");s=new a(i,[e,t,r])}}0!=r.length&&(s=new l(r,s),r=[]),t.push(s),this.expect("NEWLINE","EOF")}else if("NEWLINE"!=i.type)throw new b("Unexpected token "+i.type+": '"+i.text+"'",i);i=this.lexer.nextToken()}return{data:e,text:t,endLabels:r}}}const y=4194304,I=268500992,S=2147479548;e.exports={Lexer:w,Parser:R,Assembler:class{constructor(e){this.parser=new R(e),this.machine=new u,this.instructions=null,this.instructionsDisplay=[]}assemble(){let e=this.parser.parse(),t={},s=I;for(let i of e.data)s=i.output(this.machine.memory,s,t);let i=[],r={};for(let t of e.text){let e=t.transform();r[i.length]=t,i=i.concat(e)}let a=y;for(let e of i)a=e.collectLabels(a,t);for(let s of e.endLabels)t[s]=a;for(let e of i)a=e.transformLabels(t);a=y;for(let e=0;e<i.length;e++){let t=i[e];t.output(this.machine.memory,a),r[e]?this.instructionsDisplay.push([a,t.toString(),r[e].toString(),t]):this.instructionsDisplay.push([a,t.toString(),null,t]),a+=4}this.machine.memory.setMarker("textStart",y),this.machine.memory.setMarker("textEnd",a),this.instructions=i,t.main&&t.main>=y&&t.main<=a?this.machine.registers.pc=t.main:this.machine.registers.pc=y,this.machine.registers.set(29,S),this.machine.registers.set(31,a)}}}},function(e,t){class s{constructor(e,t){this.align=e,this.data=t}output(e,t,s){let i=2**this.align,r=t%i;return 0!=r&&(t+=i-r),this.data.output(e,t,s)}}class i extends Error{constructor(e,t){super(e),this.line=t.line,this.column=t.column}}const r=2147483647,a=-2147483648,h=32767,n=65535,c=-32768;class o{constructor(e,t,s){"string"==typeof e?(this.name=e,this.token=s):(this.token=e,this.name=e.text.toLowerCase()),this.params=t}checkRegister(e){if(e>=this.params.length)throw new i("Expected more than "+this.params.length+" parameters for instruction "+this.token.text,this.token);if(1==this.params[e])throw new i("Register $at ($1) is reserved for the assembler",this.token)}checkImmediate(e,t){if(void 0===t&&(t=!1),e>=this.params.length)throw new i("Expected more than "+this.params.length+" parameters for instruction "+this.token.text,this.token);let s=this.params[e];if(t&&(s<c||s>h))throw new i("Immediate value outside of 16bit bounds: "+s+" does not lie in ["+c+","+h+"]",this.token);if(s<a||s>r)throw new i("Immediate value outside of 32bit bounds: "+s+" does not lie in ["+a+","+r+"]",this.token);return s<c||s>h}checkAddress(e){if(e>=this.params.length)throw new i("Expected more than "+this.params.length+" parameters for instruction "+this.token.text,this.token);let t=this.params[e];if(null!==t.offset&&(t.offset<a||t.offset>r))throw new i("Address offset value outside of 32bit bounds: "+value+" does not lie in ["+a+","+r+"]",this.token);if(null!==t.register&&1==t.register)throw new i("Register $at ($1) is reserved for the assembler",this.token)}transform(){switch(this.name){case"internal":return[this];case"add":case"addu":case"and":case"nor":case"or":case"sub":case"subu":case"xor":case"slt":case"sltu":case"sllv":case"srav":case"srlv":return this.checkRegister(0),this.checkRegister(1),this.checkRegister(2),[this];case"addi":case"addiu":case"andi":case"ori":case"xori":case"slti":case"sltiu":if(this.checkRegister(0),this.checkRegister(1),this.checkImmediate(2)){let e=this.params[2];return[new o("lui",[1,e>>>16&65535],this.token),new o("ori",[1,1,65535&e],this.token),new o(this.name.replace(/i([^i]*)$/,"$1"),[this.params[0],this.params[1],1],this.token)]}return[this];case"sra":case"srl":case"sll":if(this.checkRegister(0),this.checkRegister(1),this.params[2]<0||this.params[2]>31)throw new i(this.name.toUpperCase()+" expects a 5-bit unsigned immediate",this.token);return[this];case"syscall":case"j":case"jal":return[this];case"jalr":case"mult":case"multu":case"div":case"divu":return this.checkRegister(0),this.checkRegister(1),[this];case"mul":return this.checkRegister(0),this.checkRegister(1),[new o("mult",this.params,this.token)];case"jr":case"mfhi":case"mflo":case"mthi":case"mtlo":return this.checkRegister(0),[this];case"lui":if(this.checkRegister(0),this.params[1]>n||this.params[1]<0)throw new i("LUI expects a 16-bit unsigned immediate",this.token);return[this];case"li":this.checkRegister(0),this.checkImmediate(1);let e=this.params[1];return e>=0&&e<=n?[new o("ori",[this.params[0],0,65535&e],this.token)]:e>=c&&e<=h?[new o("addiu",[this.params[0],0,65535&e],this.token)]:[new o("lui",[1,e>>>16&65535],this.token),new o("ori",[this.params[0],1,65535&e],this.token)];case"beq":case"bne":case"bgez":case"bgezal":case"bgtz":case"blez":case"bltz":case"bltz":case"bltzal":return[this];case"nop":return[new o("ori",[0,0,0],this.token)];case"lb":case"lbu":case"lh":case"lhu":case"lw":case"sb":case"sh":case"sw":case"la":let t=this.name;"la"==this.name&&(t="addi"),this.checkRegister(0),this.checkAddress(1);let s=this.params[1];if(null!==s.register&&null===s.offset&&null==s.label)return[new o(t,[this.params[0],s.register,0],this.token)];if(null!==s.register&&null!==s.offset&&null==s.label){let e=s.offset;return e<c||e>h?[new o("lui",[1,e>>>16&65535],this.token),new o("add",[1,1,s.register],this.token),new o(t,[this.params[0],1,65535&e],this.token)]:[new o(t,[this.params[0],s.register,e],this.token)]}if(null!==s.register&&null===s.offset&&null!=s.label)return[new o("lui",[1,s.label],this.token),new o("add",[1,1,s.register],this.token),new o(t,[this.params[0],1,s.label],this.token)];if(null===s.register&&null===s.offset&&null!=s.label)return[new o("lui",[1,s.label],this.token),new o(t,[this.params[0],1,s.label],this.token)];if(null===s.register&&null!==s.offset&&null==s.label){let e=s.offset;return e<c||e>h?[new o("lui",[1,e>>>16&65535],this.token),new o(t,[this.params[0],1,65535&e],this.token)]:[new o(t,[this.params[0],0,e],this.token)]}throw new i("Unimplemented address mode",this.token);default:throw new i("Semantics not implemented for instruction: "+this.token.text,this.token)}}collectLabels(e,t){return e+4}transformLabels(e){for(let t=0;t<this.params.length;t++)if("string"==typeof this.params[t]){let s=e[this.params[t]];if(void 0===s)throw new i("Undefined label used for instruction "+this.token.text,this.token);"lui"==this.name?this.params[t]=s>>>16&65535:this.params[t]=s}}outputSpecialThreeRegister(e,t,s,i,r,a){let h=i<<21|r<<16|s<<11|a;e.writeWord(t,h)}outputTwoRegisterImmediate(e,t,s,i,r,a){let h=a<<26|i<<21|s<<16|65535&r;e.writeWord(t,h)}outputRegimmInstruction(e,t,s,i,r){let a=1<<26|s<<21|r<<16|65535&i;e.writeWord(t,a)}outputInstructionAndData(e,t,s,i){let r=i<<26|67108863&s;e.writeWord(t,r)}outputShift(e,t,s,i,r,a){let h=i<<16|s<<11|r<<6|a;e.writeWord(t,h)}checkTooLargeBranchOffset(e){if(e>h||e<c)throw new i("Branch offset would exceed maximum signed 16-bit value. Offset: "+e,this.token)}output(e,t){switch(this.name){case"add":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],32);break;case"addu":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],33);break;case"and":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],36);break;case"nor":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],39);break;case"or":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],37);break;case"sub":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],34);break;case"subu":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],35);break;case"xor":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],38);break;case"slt":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],42);break;case"sltu":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],this.params[2],43);break;case"sllv":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[2],this.params[1],4);break;case"srav":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[2],this.params[1],7);break;case"srlv":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[2],this.params[1],6);break;case"syscall":this.outputSpecialThreeRegister(e,t,0,0,0,12);break;case"mult":this.outputSpecialThreeRegister(e,t,0,this.params[0],this.params[1],24);break;case"multu":this.outputSpecialThreeRegister(e,t,0,this.params[0],this.params[1],25);break;case"div":this.outputSpecialThreeRegister(e,t,0,this.params[0],this.params[1],26);break;case"divu":this.outputSpecialThreeRegister(e,t,0,this.params[0],this.params[1],27);break;case"mfhi":this.outputSpecialThreeRegister(e,t,this.params[0],0,0,16);break;case"mflo":this.outputSpecialThreeRegister(e,t,this.params[0],0,0,18);break;case"mthi":this.outputSpecialThreeRegister(e,t,0,this.params[0],0,17);break;case"mtlo":this.outputSpecialThreeRegister(e,t,0,this.params[0],0,19);break;case"lui":this.outputTwoRegisterImmediate(e,t,this.params[0],0,this.params[1],15);break;case"addi":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],8);break;case"addiu":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],9);break;case"andi":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],12);break;case"ori":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],13);break;case"xori":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],14);break;case"slti":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],10);break;case"sltiu":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],11);break;case"sll":this.outputShift(e,t,this.params[0],this.params[1],this.params[2],0);break;case"sra":this.outputShift(e,t,this.params[0],this.params[1],this.params[2],3);break;case"srl":this.outputShift(e,t,this.params[0],this.params[1],this.params[2],2);break;case"lb":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],32);break;case"lbu":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],36);break;case"lh":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],33);break;case"lhu":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],37);break;case"lw":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],35);break;case"sb":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],40);break;case"sh":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],41);break;case"sw":this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2],43);break;case"j":this.outputInstructionAndData(e,t,this.params[0]>>2,2);break;case"jal":this.outputInstructionAndData(e,t,this.params[0]>>2,3);break;case"jalr":this.outputSpecialThreeRegister(e,t,this.params[0],this.params[1],0,9);break;case"jr":this.outputSpecialThreeRegister(e,t,0,this.params[0],0,8);break;case"beq":this.checkTooLargeBranchOffset(this.params[2]-t>>2),this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2]-t>>2,4);break;case"bne":this.checkTooLargeBranchOffset(this.params[2]-t>>2),this.outputTwoRegisterImmediate(e,t,this.params[0],this.params[1],this.params[2]-t>>2,5);break;case"bgez":this.checkTooLargeBranchOffset(this.params[1]-t>>2),this.outputRegimmInstruction(e,t,this.params[0],this.params[1]-t>>2,1);break;case"bgezal":this.checkTooLargeBranchOffset(this.params[1]-t>>2),this.outputRegimmInstruction(e,t,this.params[0],this.params[1]-t>>2,17);break;case"bgtz":this.checkTooLargeBranchOffset(this.params[1]-t>>2),this.outputTwoRegisterImmediate(e,t,0,this.params[0],this.params[1]-t>>2,7);break;case"blez":this.checkTooLargeBranchOffset(this.params[1]-t>>2),this.outputTwoRegisterImmediate(e,t,0,this.params[0],this.params[1]-t>>2,6);break;case"bltz":this.checkTooLargeBranchOffset(this.params[1]-t>>2),this.outputRegimmInstruction(e,t,this.params[0],this.params[1]-t>>2,0);break;case"bltzal":this.checkTooLargeBranchOffset(this.params[1]-t>>2),this.outputRegimmInstruction(e,t,this.params[0],this.params[1]-t>>2,16);break;default:throw new i("Unsupported instruction: "+this.name,this.token)}}toString(){switch(this.name){case"add":case"addu":case"and":case"nor":case"or":case"sub":case"subu":case"xor":case"slt":case"sltu":case"sllv":case"srav":case"srlv":return this.name+" $"+this.params[0]+", $"+this.params[1]+", $"+this.params[2];case"syscall":return this.name;case"mul":case"mult":case"multu":case"div":case"divu":return this.name+" $"+this.params[0]+", $"+this.params[1];case"mfhi":case"mflo":case"mthi":case"mtlo":return this.name+" $"+this.params[0];case"lui":case"li":return this.name+" $"+this.params[0]+", "+this.params[1];case"nop":return this.name;case"addi":case"addiu":case"andi":case"ori":case"xori":case"slti":case"sltiu":return this.name+" $"+this.params[0]+", $"+this.params[1]+", "+this.params[2];case"lb":case"lbu":case"lh":case"lhu":case"lw":case"sb":case"sh":case"sw":return 2==this.params.length?this.name+" $"+this.params[0]+", "+this.params[1].toString():this.name+" $"+this.params[0]+", "+(65535&this.params[2])+"($"+this.params[1]+")";case"j":case"jal":return this.name+" 0x"+this.params[0].toString(16).toUpperCase();case"jalr":return this.name+" $"+this.params[0]+", $"+this.params[1];case"jr":return this.name+" $"+this.params[0];case"beq":case"bne":return this.name+" $"+this.params[0]+", $"+this.params[1]+", 0x"+this.params[2].toString(16).toUpperCase();case"bgez":case"bgezal":case"bgtz":case"blez":case"bltz":case"bltzal":return this.name+" $"+this.params[0]+", 0x"+this.params[1];default:return"unknown instruction"}}}class l{constructor(e,t){this.labels=e,this.instruction=t}transform(){let e=this.instruction.transform();return e.length>0&&(e[0]=new l(this.labels,e[0])),e}collectLabels(e,t){for(let s of this.labels){if(void 0!==t[s])throw new i("Label '"+s+"' defined twice",this.instruction.token);t[s]=e}return this.instruction.collectLabels(e,t)}transformLabels(e){return this.instruction.transformLabels(e)}output(e,t){return this.instruction.output(e,t)}toString(){let e="";for(let t=0;t<this.labels.length;t++)0!=t&&(e+=", "),e+=this.labels[t];return e+": "+this.instruction.toString()}}e.exports={Instruction:o,LabeledInstruction:l,AlignedData:s,LabeledData:class{constructor(e,t){this.labels=e,this.data=t}output(e,t,s){for(let e of this.labels){if(void 0!==s[e])throw new Error("Label '"+e+"' defined twice");s[e]=t}return this.data.output(e,t,s)}},AlignedData:s,Address:class{constructor(e,t,s){this.register=e,this.label=t,this.offset=s}toString(){let e="";return null!==this.label?e+=this.label:null!==this.offset&&(e+=this.offset),null!==this.register&&(e+="($"+this.register+")"),e}},IntData:class{constructor(e,t){this.value=e,this.size=t}output(e,t,s){switch(this.size){case 4:return e.writeWord(t,this.value),t+4;case 2:return e.writeHalf(t,this.value),t+2;case 1:return e.writeByte(t,this.value),t+1;default:throw new Error("Unsupported size '"+this.size+"' for IntData")}}},BytesData:class{constructor(e){this.value=e}output(e,t,s){for(let s=0;s<this.value.length;s++)e.writeByte(t+s,this.value[s]);return t+this.value.length}}}},function(e,t,s){const i=s(5),r=s(6),a=1,h=2,n=3,c=4,o=5,l=6,u=7,p=8,m=8,d=4096;class g{constructor(e,t,s){this.type=e,this.val1=t,this.val2=s}undo(e){switch(this.type){case a:e.registers.set(this.val1,this.val2);break;case h:e.registers.setPC(this.val1);break;case o:e.memory.writeByte(this.val1,this.val2);break;case c:e.memory.writeHalf(this.val1,this.val2);break;case n:e.memory.writeWord(this.val1,this.val2);break;case l:e.registers.hi=this.val1;break;case u:e.registers.lo=this.val1;break;case p:e.consoleOutput=e.consoleOutput.substring(0,e.consoleOutput.length-this.val1);break;case m:e.assertionMessage=null}}addChanges(e){switch(this.type){case a:e.registers.push(this.val1);break;case h:e.registers.push("pc");break;case o:e.memory.push(this.val1);break;case c:e.memory.push(this.val1),e.memory.push(this.val1+1);break;case n:for(let t=0;t<4;t++)e.memory.push(this.val1+t);break;case l:e.registers.push("hi");break;case u:e.registers.push("lo")}}}class k extends Error{constructor(e){super(e)}}class w{constructor(){this.memory=new i,this.registers=new r,this.undoStack=[],this.consoleOutput="",this.assertionMessage=null}static mult64unsigned(e,t){let s=e>>>16,i=t>>>16,r=65535&e,a=65535&t,h=s*a+r*i,n=r*a,c=h+(n>>>16);return[s*i+(c>>>16)+(c>4294967295?65536:0)>>>0,(h<<16)+n>>>0]}static mult64signed(e,t){let s=e>>16,i=t>>16,r=65535&e,a=65535&t,h=s*a+r*i,n=r*a,c=h+(n>>>16);return[s*i+(c>>16)+(c>4294967295?65536:0)>>>0,(h<<16)+n>>>0]}makeUnsignedFloat(e){return 65536*(e>>>16)+(65535&e)}toHex(e){return"0x"+e.toString(16).toUpperCase()}executeSpecialInstruction(e){let t=63&e,s=e>>21&31,i=e>>16&31,r=e>>11&31,h=e>>6&31,n=this.registers.get(s),c=this.registers.get(i),o=this.registers.get(r),b=this.registers.getPC()+4;switch(t){case 32:case 33:this.registers.set(r,n+c|0),this.undoStack.push(new g(a,r,o));break;case 36:this.registers.set(r,n&c),this.undoStack.push(new g(a,r,o));break;case 39:this.registers.set(r,~(n|c)),this.undoStack.push(new g(a,r,o));break;case 37:this.registers.set(r,n|c),this.undoStack.push(new g(a,r,o));break;case 34:case 35:this.registers.set(r,n-c|0),this.undoStack.push(new g(a,r,o));break;case 38:this.registers.set(r,n^c),this.undoStack.push(new g(a,r,o));break;case 0:this.registers.set(r,c<<h),this.undoStack.push(new g(a,r,o));break;case 4:this.registers.set(r,c<<(31&n)),this.undoStack.push(new g(a,r,o));break;case 3:this.registers.set(r,c>>h),this.undoStack.push(new g(a,r,o));break;case 4:this.registers.set(r,c>>(31&n)),this.undoStack.push(new g(a,r,o));break;case 2:this.registers.set(r,c>>>h),this.undoStack.push(new g(a,r,o));break;case 4:this.registers.set(r,c>>>(31&n)),this.undoStack.push(new g(a,r,o));break;case 42:this.registers.set(r,n<c?1:0),this.undoStack.push(new g(a,r,o));break;case 43:n=this.makeUnsignedFloat(n),c=this.makeUnsignedFloat(c),this.registers.set(r,n<c?1:0),this.undoStack.push(new g(a,r,o));break;case 8:b=n;break;case 9:b=n,this.registers.set(s,this.registers.getPC()+4),this.undoStack.push(new g(a,s,n));break;case 24:case 25:let e;e=24==t?w.mult64signed(n,c):w.mult64unsigned(n,c),this.undoStack.push(new g(l,this.registers.hi)),this.undoStack.push(new g(u,this.registers.lo)),this.registers.hi=0|e[0],this.registers.lo=0|e[1];break;case 26:case 27:{let e,s;27==t&&(n=this.makeUnsignedFloat(n),c=this.makeUnsignedFloat(c)),0==c?(e=0,s=0):(e=n%c|0,li=n/c|0),this.undoStack.push(new g(l,this.registers.hi)),this.undoStack.push(new g(u,this.registers.lo)),this.registers.hi=e,this.registers.lo=s;break}case 16:this.registers.set(r,this.registers.hi),this.undoStack.push(new g(a,r,o));break;case 17:this.undoStack.push(new g(l,this.registers.hi)),this.registers.hi=n;break;case 18:this.registers.set(r,this.registers.lo),this.undoStack.push(new g(a,r,o));break;case 19:this.undoStack.push(new g(u,this.registers.lo)),this.registers.lo=n;break;case 12:let i=null,f=this.registers.get(2);switch(f){case 1:i=this.registers.get(4).toString();break;case 4:case 1e3:let e=this.registers.get(4),t=this.memory.readUnsignedByte(e);i="";let s=0;for(;0!=t&&s<d;)i+=String.fromCharCode(127&t),t=this.memory.readUnsignedByte(++e),s++;if(s>=d)throw new k("print syscall string exceeds maximum of "+d+" characters (no null terminator?)");break;case 11:i=String.fromCharCode(127&this.registers.get(4))}"string"==typeof i&&(1e3==f?(this.undoStack.push(new g(m)),this.assertionMessage=i):(this.undoStack.push(new g(p,i.length)),this.consoleOutput+=i));break;default:throw new k("Unrecognized special instruction code: "+this.toHex(t))}return b}executeRegimmInstruction(e){let t=e>>16&31,s=e>>21&31,i=(65535&e)<<16>>14,r=this.registers.get(s),h=this.registers.getPC()+4,n=this.registers.getPC()+4,c=this.registers.get(31);switch(t){case 1:r>=0&&(h=this.registers.getPC()+i);break;case 17:r>=0&&(h=this.registers.getPC()+i,this.registers.set(31,n),this.undoStack.push(new g(a,31,c)));break;case 0:r<0&&(h=this.registers.getPC()+i);break;case 16:r<0&&(h=this.registers.getPC()+i,this.registers.set(31,n),this.undoStack.push(new g(a,31,c)));break;default:throw new k("Unrecognized regimm instruction code: "+this.toHex(t))}return h}executeMemoryInstruction(e){let t=e>>>26&63,s=e>>21&31,i=e>>16&31,r=(65535&e)<<16>>16,h=this.registers.get(s),l=this.registers.get(i),u=this.registers.getPC()+4,p=h+r,m=0;switch(t){case 32:this.registers.set(i,this.memory.readByte(p)),this.undoStack.push(new g(a,i,l));break;case 36:this.registers.set(i,this.memory.readUnsignedByte(p)),this.undoStack.push(new g(a,i,l));break;case 33:this.registers.set(i,this.memory.readHalf(p)),this.undoStack.push(new g(a,i,l));break;case 37:this.registers.set(i,this.memory.readUnsignedHalf(p)),this.undoStack.push(new g(a,i,l));break;case 35:this.registers.set(i,this.memory.readWord(p)),this.undoStack.push(new g(a,i,l));break;case 40:m=this.memory.readUnsignedByte(p),this.memory.writeByte(p,this.registers.get(i)),this.undoStack.push(new g(o,p,m));break;case 41:m=this.memory.readUnsignedHalf(p),this.memory.writeHalf(p,this.registers.get(i)),this.undoStack.push(new g(c,p,m));break;case 43:m=this.memory.readWord(p),this.memory.writeWord(p,this.registers.get(i)),this.undoStack.push(new g(n,p,m));break;default:throw new k("Unrecognized instruction code: "+this.toHex(t))}return u}executeImmediateInstruction(e){let t=e>>>26&63,s=e>>21&31,i=e>>16&31,r=this.registers.get(s),h=this.registers.get(i),n=65535&e,c=n<<16>>16,o=this.registers.getPC()+4;switch(t){case 15:this.registers.set(i,n<<16),this.undoStack.push(new g(a,i,h));break;case 8:case 9:this.registers.set(i,r+c|0),this.undoStack.push(new g(a,i,h));break;case 12:this.registers.set(i,r&n),this.undoStack.push(new g(a,i,h));break;case 13:this.registers.set(i,r|n),this.undoStack.push(new g(a,i,h));break;case 14:this.registers.set(i,r^n),this.undoStack.push(new g(a,i,h));break;case 10:this.registers.set(i,r<c?1:0),this.undoStack.push(new g(a,i,h));break;case 11:r=this.makeUnsignedFloat(r),c=this.makeUnsignedFloat(c),this.registers.set(i,r<c?1:0),this.undoStack.push(new g(a,i,h));break;case 4:r==h&&(o=this.registers.getPC()+(c<<2));break;case 5:r!=h&&(o=this.registers.getPC()+(c<<2));break;case 7:r>0&&(o=this.registers.getPC()+c<<2);break;case 6:r<=0&&(o=this.registers.getPC()+c<<2);break;default:throw new k("Unrecognized instruction code: "+this.toHex(t))}return o}executeInstruction(){let e=this.registers.getPC();if(null!==this.assertionMessage)return!0;if(e==this.memory.getMarker("textEnd"))return!0;if(e<this.memory.getMarker("textStart"))throw new k("Invalid program counter "+this.toHex(e)+" is in memory before text segment");if(e>this.memory.getMarker("textEnd")+4)throw new k("Invalid program counter "+this.toHex(e)+" is in memory after text segment");if(e%4!=0)throw new k("Invalid program counter "+this.toHex(e)+" is not aligned to 4 bytes");let t=this.memory.readWord(e),s=t>>>26&63,i=e+4;switch(s){case 0:i=this.executeSpecialInstruction(t);break;case 1:i=this.executeRegimmInstruction(t);break;case 15:case 8:case 9:case 12:case 13:case 14:case 10:case 11:case 4:case 5:case 7:case 6:i=this.executeImmediateInstruction(t);break;case 32:case 36:case 33:case 37:case 35:case 40:case 41:case 43:i=this.executeMemoryInstruction(t);break;case 2:i=-268435456&e,i|=(67108863&t)<<2;break;case 3:i=-268435456&e,i|=(67108863&t)<<2,this.registers.set(31,e+4),this.undoStack.push(new g(a,31,this.registers.get(31)));break;default:throw new k("Unrecognized instruction code: "+this.toHex(s))}return this.undoStack.push(new g(h,e,null)),this.registers.setPC(i),!1}step(){return this.executeInstruction()}undoStep(){if(0==this.undoStack.length)return!1;let e=this.undoStack.pop();if(e.undo(this),0==this.undoStack.length)return!1;for(e=this.undoStack[this.undoStack.length-1];e.type!=h;){if(this.undoStack.pop(),e.undo(this),0==this.undoStack.length)return!1;e=this.undoStack[this.undoStack.length-1]}return!0}changesOfLastInstruction(){let e={registers:[],memory:[]};for(let t=0;t<this.undoStack.length;t++){let s=this.undoStack[this.undoStack.length-1-t];if(s.type==h&&0!=t)break;s.addChanges(e)}return e}}e.exports=w},function(e,t){e.exports=class{constructor(){this.table={},this.markers={}}setMarker(e,t){this.markers[e]=t}getMarker(e){return this.markers[e]}base(e){return e/1024|0}remainder(e){return e%1024|0}allocate(e){let t=this.base(e);this.table[t]||(this.table[t]=new Uint8Array(1024))}readWord(e){return this.readUnsignedByte(e)|this.readUnsignedByte(e+1)<<8|this.readUnsignedByte(e+2)<<16|this.readUnsignedByte(e+3)<<24}writeWord(e,t){this.writeByte(e,255&t),this.writeByte(e+1,t>>>8&255),this.writeByte(e+2,t>>>16&255),this.writeByte(e+3,t>>>24&255)}readHalf(e){return this.readUnsignedByte(e)|this.readByte(e+1)<<8}readUnsignedHalf(e){return this.readUnsignedByte(e)|this.readUnsignedByte(e+1)<<8}writeHalf(e,t){this.writeByte(e,255&t),this.writeByte(e+1,t>>>8&255)}readByte(e){this.allocate(e);let t=this.base(e);return this.table[t][this.remainder(e)]<<24>>24}readUnsignedByte(e){this.allocate(e);let t=this.base(e);return this.table[t][this.remainder(e)]}writeByte(e,t){this.allocate(e);let s=this.base(e);this.table[s][this.remainder(e)]=255&t}}},function(e,t){e.exports=class{constructor(){this.gprs=new Int32Array(32),this.hi=0,this.lo=0,this.pc=0}getPC(){return this.pc}setPC(e){this.pc=e}get(e){return this.gprs[e]}set(e,t){0!=e&&(this.gprs[e]=t)}}}]);